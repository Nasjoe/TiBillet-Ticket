{% load i18n tibitags %}
<form id="reservation_form" hx-post="reservation/">
    <input type="hidden" name="event" value="{{ event.uuid }}">

    {% if user.is_anonymous %}
        <div class="mb-3">
            <label for="booking-regular" class="form-label">Email</label>
            <input type="email" name="email" class="form-control" id="booking-regular">
        </div>
        <div class="mb-3">
            <label for="booking-regular" class="form-label">Confirmez votre email</label>
            <input type="email" name="email-confirm" class="form-control" id="booking-regular">
        </div>
        <p><code>{{ user.email }}</code></p>
    {% elif user.is_active %}
        <div class="mb-3">
            <label for="booking-regular" class="form-label">Email</label>
            <input type="email" class="form-control" id="booking-regular" name="email" value="{{ user.email }}"
                   readonly>
        </div>
    {% else %}
        <p><code>{% translate "Vous n'avez pas validé votre email. Merci de vérifier dans vos spams :)" %}</code></p>
    {% endif %}

    {% for product in event.products.all %}
        {% if product.publish %}
            {% for price in product.prices.all %}
                {% if price.publish %}
                    <div class="mb-3">
                        <label for="booking-regular" class="form-label">
                            {{ price.name }}{% if price.prix > 0 %} : {{ price.prix }}€{% endif %}</label>

                        <!-- Adhésion obligatoire pour selectionner ce produit ! -->
                        {% if price.adhesion_obligatoire %}
                            {% if not user.is_authenticated %}
                                {% trans "Connectez vous pour afficher ce produit." %}

                            {% elif not user|is_membership:price.adhesion_obligatoire %}
                                {% trans "Adhérez pour profiter de ce tarif." %}
                            {% else %}
                                <input type="number" step="1" min="0" max="{{ event.max_per_user }}"
                                       class="form-control"
                                       id="price-{{ price.uuid }}"
                                       value="1" {# todo: a virer en prod, pour dev #}
                                       name="{{ price.uuid }}">
                            {% endif %}

                        <!-- Adhésion non obligatoire -->
                        {% else %}
                            <input type="number" step="1" min="0" max="{{ event.max_per_user }}" class="form-control"
                                   id="price-{{ price.uuid }}"
                                   value="1" {# todo: a virer en prod, pour dev #}
                                   name="{{ price.uuid }}">
                        {% endif %}
                    </div>

                {% endif %}
            {% endfor %}
        {% endif %}
    {% endfor %}

    {% for option in event.options_radio.all %}
        <div class="d-flex flex-row justify-content-start align-items-start mb-3 has-validation">
            <div class="form-check me-3">
                <input id="option-radio-{{ option.uuid }}" name="options"
                       class="form-check-input" type="radio" value="{{ option.uuid }}"
                       required>
                <label class="custom-control-label" for="option-radio-{{ option.uuid }}">
                    {{ option.name }}
                </label>
            </div>
        </div>
    {% endfor %}

    {% for option in event.options_checkbox.all %}
        <div class="form-check form-switch mb-3">
            <input class="form-check-input" type="checkbox" role="switch" id="option-checkbox-{{ option.uuid }}"
                   name="options" value="{{ option.uuid }}">
            <label class="form-check-label" for="option-checkbox-{{ option.uuid }}">
                {{ option.name }}
            </label>
        </div>
    {% endfor %}

    <h4>Total : 0 place(s) pour <span class="fs-5 badge bg-secondary-subtle mb-md-0">0,00€</span></h4>

    <p>
        Jauge maximale de {{ event.jauge_max }} personnes et un nombre de
        billets limité à {{ event.max_per_user }} par réservation.
    </p>

    <div class="position-absolute bottom-0 start-0 end-0 p-3">
        <button type="submit" class="btn btn-primary w-100 mb-3">Confirmer la réservation</button>
        <a href="." class="btn btn-danger d-block">Annuler</a>
    </div>
</form>
